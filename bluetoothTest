//#include <SoftwareSerial.h>
#include <StackList.h>
#include "timer-api.h"
StackList <int> ButList;
boolean training = false;
boolean StopTraining=false;
String mesage;
int reaction=0;
int actionBut;
//SoftwareSerial HC06(1,0);
void setup() {
  Serial.begin(9600);
//  HC06.begin(9600);
  timer_init_ISR_1Hz(TIMER_DEFAULT);
}
void timer_handle_interrupts(int timer) {
  reaction++;
 // if (Serial.available()){
    chatHC06();
 // }
}
void pushBut(){
  int gameBut;
  while (!ButList.isEmpty ()){
    actionBut=ButList.pop();
    reaction=0;
    Serial.print("Нажмите кнопку: ");
    Serial.println(actionBut);
    gameBut= Serial.read();
    while (actionBut!=gameBut){
      gameBut= Serial.read();
    }
    Serial.println("Нужная кнопка нажата");
  }
}
void chatHC06(){
  //mesage=HC06.read();
  mesage=Serial.read();
  if (mesage.equalsIgnoreCase("стоп") ){
    StopTraining = true;
    training= false;
    //HC06.println("Для завершения тренеровкеи, нажмите на последнию горящию кнопку");
    Serial.println("Для завершения тренеровкеи, нажмите на последнию горящию кнопку");
  }
  else if( training){
    //HC06.println("Тренеровка выполняется, дождитесь завершения тренеровки.Или напишите Стоп для завершения");
    Serial.println("Тренеровка выполняется, дождитесь завершения тренеровки.Или напишите Стоп для завершения");
  }
  else if(mesage.equalsIgnoreCase("Старт") ){
    training=true;
    pushBut();
  }
  else if(!mesage.charAt(0)==(',')){
    //HC06.println("Нало записи последовательности");
    Serial.println("Нало записи последовательности");
    mesage.trim();
    int STStr;
    int ENStr;
    boolean StrOn=false;
    int t=mesage.length();
    for(int i =0;i<=t;i++){
      
      if ((!mesage.charAt(i)==',')&&(!StrOn)){
        StrOn=true;
        STStr=i;
      }
      if (mesage.charAt(i)==','){
        StrOn=false;
        ENStr=i;
      }
      if (!StrOn){
        ButList.push(mesage.substring(STStr,ENStr).toInt());
      }
  }
 // HC06.println("Конец записи последовательности.Напишите старт для начала тренеровки");
  Serial.println("Конец записи последовательности.Напишите старт для начала тренеровки");
 }
}

void loop() {
 // Serial.println(HC06.read());
  if (Serial.available()){
    chatHC06();
  }
}
